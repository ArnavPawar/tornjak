FROM node:19.6 AS build
WORKDIR /usr/src/app
COPY tornjak-frontend ./
RUN npm install
RUN rm -rf build
RUN NODE_OPTIONS=--openssl-legacy-provider npm run build

FROM node:19.6-alpine
WORKDIR /usr/src/app
COPY --from=build /usr/src/app/build ./

# set env variables
ENV REACT_APP_API_SERVER_URI $REACT_APP_API_SERVER_URI
ENV REACT_APP_AUTH_SERVER_URI $REACT_APP_AUTH_SERVER_URI
ENV NODE_OPTIONS $NODE_OPTIONS

EXPOSE 3000

# start app
CMD ["npx", "serve", "-s", "."]
